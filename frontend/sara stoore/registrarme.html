<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Registro - Sara Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow p-5" style="width: 42rem">
         <div class="row align-items-center mb-5">
    <div class="col-md-6 text-center">
      <img
        src="logo.webp"
        alt="Logo"
        class="img-fluid"
        style="max-width: 100%; height: auto"
      />
    </div>

    <div class="col-md-6 mt-5 ml-8">
      <h3 class="text-primary mb-3">Crea tu cuenta</h3>
      <p class="mb-1">¿Ya tienes una cuenta?</p>
      <a href="login.html">Iniciar sesión</a>
    </div>
  </div>
      <form id="registroForm">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="nombre" class="form-label fw-bold">Nombres</label>
            <input type="text" class="form-control" id="nombre" placeholder="Ingresa tus nombres" required>
          </div>
          <div class="col-md-6">
            <label for="apellido" class="form-label fw-bold">Apellidos</label>
            <input type="text" class="form-control" id="apellido" placeholder="Ingresa tus apellidos" required>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="tipoId" class="form-label fw-bold">Tipo de Identificación</label>
            <select class="form-select" id="tipoId" required>
              <option selected disabled>Selecciona</option>
              <option value="CC">Cédula de Ciudadanía</option>
              <option value="TI">Tarjeta de Identidad</option>
              <option value="CE">Cédula de Extranjería</option>
              <option value="PP">Pasaporte</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="numId" class="form-label fw-bold">Número de Identificación</label>
            <input type="text" class="form-control" id="numId" placeholder="Número de documento" required>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="celular" class="form-label fw-bold">Celular</label>
            <input type="tel" class="form-control" id="celular" placeholder="Ej: 3001234567" required>
          </div>
          <div class="col-md-6">
            <label for="correo" class="form-label fw-bold">Correo electrónico</label>
            <input type="email" class="form-control" id="correo" placeholder="Ingresa tu correo" required>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="confirmCorreo" class="form-label fw-bold">Confirmar correo electrónico</label>
            <input type="email" class="form-control" id="confirmCorreo" placeholder="Repite tu correo" required>
          </div>
          <div class="col-md-6">
            <label for="contrasena" class="form-label fw-bold">Contraseña</label>
            <input type="password" class="form-control" id="contrasena" placeholder="Crea una contraseña" required>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <label for="confirmContrasena" class="form-label fw-bold">Confirmar contraseña</label>
            <input type="password" class="form-control" id="confirmContrasena" placeholder="Repite tu contraseña" required>
          </div>
          <div class="col-md-6 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Registrarme</button>
          </div>
        </div>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      document.getElementById('registroForm').addEventListener('submit', async function(e) {
        e.preventDefault(); // Prevenir el envío normal del formulario
        
        // Obtener los valores del formulario y mapearlos a lo que espera el backend
        const formData = {
          nombre: document.getElementById('nombre').value + ' ' + document.getElementById('apellido').value,
          correo: document.getElementById('correo').value,
          telefono: document.getElementById('celular').value,
          direccion: '',
          ciudad: '',
          departamento: '', 
          password: document.getElementById('contrasena').value
        };
        
        // Validaciones
        const confirmarCorreo = document.getElementById('confirmCorreo').value;
        const confirmarContrasena = document.getElementById('confirmContrasena').value;
        
        if (formData.correo !== confirmarCorreo) {
          alert('Los correos electrónicos no coinciden');
          return;
        }
        
        if (formData.password !== confirmarContrasena) {
          alert('Las contraseñas no coinciden');
          return;
        }
        
        // Cambiar texto del botón mientras se procesa
        const submitButton = document.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        submitButton.textContent = 'Registrando...';
        submitButton.disabled = true;
        
        try {
          // Realizar la petición al endpoint de Spring Boot
          const response = await fetch('http://localhost:8080/api/usuario', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });
          
          if (response.ok) {
            const result = await response.json();
            alert(result.mensaje || '¡Registro exitoso! Bienvenido a Sara Store');

            //redirigir a la página de login
            window.location.href = 'login.html';
          } else {
            const error = await response.json();
            alert('Error en el registro: ' + (error.message || 'Error desconocido'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error de conexión. Por favor, verifica que el servidor esté funcionando.');
        } finally {
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      });
    </script>
  </body>
</html>
