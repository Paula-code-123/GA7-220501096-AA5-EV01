<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Pago - Sara Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow p-5" style="width: 30rem">
      <div class="text-center mb-4">
        <img
          src="logo.webp"
          alt="Logo Sara Store"
          style="max-width: 100px"
          class="mb-3"
        />
        <h4 class="fw-bold text-primary">Elige tu método de pago</h4>
      </div>
      <div class="d-grid gap-3">
        <button
          class="btn btn-primary btn-lg"
          onclick="mostrarOpcion('tarjeta')"
        >
          <i class="bi bi-credit-card"></i> Pagar con tarjeta
        </button>
        <button class="btn btn-warning btn-lg" onclick="mostrarOpcion('nequi')">
          Pagar con Nequi
        </button>
        <button
          class="btn btn-outline-secondary btn-lg"
          onclick="mostrarOpcion('contraentrega')"
        >
          <i class="bi bi-cash"></i> Pagar contraentrega
        </button>
      </div>
      <div id="opcion-pago" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.js"></script>
    <script>
      function mostrarOpcion(opcion) {
        let html = "";
        if (opcion === "tarjeta") {
          html = `
            <h5 class="text-center mb-3">Pago con tarjeta</h5>
            <form id="form-tarjeta">
              <div class="mb-3">
                <label class="form-label">Número de tarjeta</label>
                <input type="text" id="numero-tarjeta" class="form-control" maxlength="19" placeholder="1234 5678 9012 3456" required>
                <small class="text-muted">Solo números</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Nombre en la tarjeta</label>
                <input type="text" class="form-control" required>
              </div>
              <div class="row mb-3">
                <div class="col">
                  <label class="form-label">Vencimiento</label>
                  <input type="text" id="vencimiento" class="form-control" placeholder="MM/AA" maxlength="5" required>
                  <small class="text-muted">Solo números</small>
                </div>
                <div class="col">
                  <label class="form-label">CVV</label>
                  <input type="text" id="cvv" class="form-control" maxlength="4" placeholder="123" required>
                  <small class="text-muted">Solo números</small>
                </div>
              </div>
              <button type="submit" class="btn btn-success w-100">Pagar</button>
            </form>
          `;
        } else if (opcion === "nequi") {
          html = `
            <h5 class="text-center mb-3">Pago con Nequi</h5>
            <p>Realiza una transferencia al número <strong>300 123 4567</strong> y envía el comprobante al WhatsApp <a href="https://wa.me/573001234567" target="_blank">+57 300 123 4567</a>.</p>
            <button class="btn btn-success w-100 mt-3" id="btn-confirmar-nequi">Ya pagué</button>
          `;
        } else if (opcion === "contraentrega") {
          localStorage.removeItem("carrito");
          html = `
            <div class="alert alert-success text-center">
              <h5 class="mb-3">¡Pedido registrado!</h5>
              <p>Tu pedido ha sido registrado exitosamente.<br>
              Pronto te contactaremos para la entrega y pago contraentrega.</p>
              <a href="paginaPrincipal.html" class="btn btn-primary mt-2">Volver al inicio</a>
            </div>
          `;
        }
        document.getElementById("opcion-pago").innerHTML = html;
        
        // Agregar validaciones si es formulario de tarjeta
        if (opcion === "tarjeta") {
          agregarValidacionesTarjeta();
        }
      }

      function agregarValidacionesTarjeta() {
        // Validación para número de tarjeta (solo números y formato con espacios)
        const numeroTarjeta = document.getElementById('numero-tarjeta');
        numeroTarjeta.addEventListener('input', function(e) {
          // Eliminar todo lo que no sean números
          let valor = e.target.value.replace(/\D/g, '');
          
          // Limitar a 16 dígitos
          valor = valor.substring(0, 16);
          
          // Agregar espacios cada 4 dígitos
          valor = valor.replace(/(\d{4})(?=\d)/g, '$1 ');
          
          e.target.value = valor;
        });

        // Validación para vencimiento (MM/AA)
        const vencimiento = document.getElementById('vencimiento');
        vencimiento.addEventListener('input', function(e) {
          // Eliminar todo lo que no sean números
          let valor = e.target.value.replace(/\D/g, '');
          
          // Limitar a 4 dígitos
          valor = valor.substring(0, 4);
          
          // Agregar la barra después del mes (2 dígitos)
          if (valor.length >= 2) {
            valor = valor.substring(0, 2) + '/' + valor.substring(2);
          }
          
          e.target.value = valor;
        });

        // Validar mes (01-12)
        vencimiento.addEventListener('blur', function(e) {
          const valor = e.target.value;
          if (valor.length >= 2) {
            const mes = parseInt(valor.substring(0, 2));
            if (mes < 1 || mes > 12) {
              e.target.setCustomValidity('Mes inválido (01-12)');
              e.target.classList.add('is-invalid');
            } else {
              e.target.setCustomValidity('');
              e.target.classList.remove('is-invalid');
            }
          }
        });

        // Validación para CVV (solo números)
        const cvv = document.getElementById('cvv');
        cvv.addEventListener('input', function(e) {
          // Eliminar todo lo que no sean números
          let valor = e.target.value.replace(/\D/g, '');
          
          // Limitar a 4 dígitos
          valor = valor.substring(0, 4);
          
          e.target.value = valor;
        });

        // Prevenir pegado de texto no numérico
        [numeroTarjeta, vencimiento, cvv].forEach(campo => {
          campo.addEventListener('paste', function(e) {
            e.preventDefault();
            const pastedData = (e.clipboardData || window.clipboardData).getData('text');
            const soloNumeros = pastedData.replace(/\D/g, '');
            
            // Disparar evento input para aplicar formato
            campo.value = soloNumeros;
            campo.dispatchEvent(new Event('input'));
          });
        });
      }

      // Manejo del submit para tarjeta y confirmación para Nequi
      document.getElementById("opcion-pago").addEventListener("submit", function(e) {
        if (e.target && e.target.id === "form-tarjeta") {
          e.preventDefault();
          localStorage.removeItem("carrito");
          document.getElementById("opcion-pago").innerHTML = `
            <div class="alert alert-success text-center">
              <h5 class="mb-3">¡Pago exitoso!</h5>
              <p>Tu pago ha sido procesado correctamente.<br>
              Pronto recibirás la confirmación de tu pedido.</p>
              <a href="paginaPrincipal.html" class="btn btn-primary mt-2">Volver al inicio</a>
            </div>
          `;
        }
      });

      document.getElementById("opcion-pago").addEventListener("click", function(e) {
        if (e.target && e.target.id === "btn-confirmar-nequi") {
          localStorage.removeItem("carrito");
          document.getElementById("opcion-pago").innerHTML = `
            <div class="alert alert-success text-center">
              <h5 class="mb-3">¡Pago registrado!</h5>
              <p>Hemos recibido tu comprobante.<br>
              Pronto te contactaremos para confirmar tu pedido.</p>
              <a href="paginaPrincipal.html" class="btn btn-primary mt-2">Volver al inicio</a>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>