<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Tienda virtual Sara Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-light d-flex justify-content-center align-items-center vh-100"
  >
    <div class="card shadow p-5" style="width: 32rem">
      <img
        src="logo.webp"
        alt="Logo"
        class="mb-3 mx-auto d-block"
        style="width: 50%; height: auto"
      />
      <h3 class="text-center text-primary mb-4">Ingresa con tu usuario</h3>
      <form id="loginForm">
        <div class="mb-3">
          <label for="usuario" class="form-label fw-bold">Correo electrónico</label>
          <input
            type="email"
            class="form-control"
            id="usuario"
            placeholder="Ingresa tu correo"
            required
          />
        </div>
        <div class="mb-4">
          <label for="contrasena" class="form-label fw-bold">Contraseña</label>
          <input
            type="password"
            class="form-control"
            id="contrasena"
            placeholder="Ingresa tu contraseña"
            required
          />
        </div>
        <button type="submit" class="btn btn-primary w-100 mb-3">
          Iniciar sesión
        </button>
      </form>
      <div class="text-center">
        <a href="#">¿Olvidaste tu contraseña?</a>
        <p class="mt-3 mb-1">¿No tienes una cuenta?</p>
        <a href="registrarme.html" class="text-decoration-none">Regístrate</a>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
          e.preventDefault(); // Prevenir el envío normal del formulario
          
          // Obtener los valores del formulario
          const correo = document.getElementById('usuario').value.trim();
          const contrasena = document.getElementById('contrasena').value;
          
          // Validaciones básicas
          if (!correo || !contrasena) {
            alert('Por favor, ingresa tu correo y contraseña');
            return;
          }
          
          // Validar formato de email
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(correo)) {
            alert('Por favor, ingresa un correo electrónico válido');
            document.getElementById('usuario').focus();
            return;
          }
          
          console.log('Validaciones pasadas, intentando login con:', correo);
          
          // Cambiar texto del botón mientras se procesa
          const submitButton = document.querySelector('button[type="submit"]');
          const originalText = submitButton.textContent;
          submitButton.textContent = 'Iniciando sesión...';
          submitButton.disabled = true;
          
          try {
            // Crear FormData para enviar como parámetros de formulario
            const formData = new FormData();
            formData.append('correo', correo);
            formData.append('contrasena', contrasena);
            
            const response = await fetch('http://localhost:8080/api/usuario/login', {
              method: 'POST',
              body: formData
            });
            
            console.log('Respuesta del servidor:', response.status);
            
            if (response.ok) {
              const result = await response.text();
              alert('¡Login exitoso! Bienvenido de vuelta');
              
              // Redirigir a la página principal
              window.location.href = 'paginaPrincipal.html';
            } else {
              const error = await response.text();
              console.error('Error de login:', error);
              alert('Error: ' + error);
              
              // Limpiar campos si las credenciales son incorrectas
              document.getElementById('contrasena').value = '';
              document.getElementById('usuario').focus();
            }
          } catch (error) {
            console.error('Error de conexión:', error);
            alert('Error de conexión. Por favor, verifica que el servidor esté funcionando.');
          } finally {
            // Restaurar el botón
            submitButton.textContent = originalText;
            submitButton.disabled = false;
          }
        });
      });
    </script>
  </body>
</html>
